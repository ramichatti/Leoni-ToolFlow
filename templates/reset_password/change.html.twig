{% extends 'base.html.twig' %}

{% block title %}Change Password - Leoni ToolFlow{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/login.css') }}">
    <style>
        .alert {
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .password-requirements {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color-saturated);
            font-size: 0.9em;
            color: #666;
        }
        .requirements-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .requirement {
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
            transition: all 0.3s ease;
        }
        .requirement.valid {
            color: #28a745;
        }
        .requirement.invalid {
            color: #dc3545;
        }
        .requirement .icon-check {
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .requirement.valid .icon-check {
            color: #28a745;
        }
        .requirement.invalid .icon-check {
            color: #dc3545;
        }
    </style>
{% endblock %}

{% block body %}
<div class="session">
    <div class="left" style="background-color: white; padding: 10px;">
        <img src="{{ asset('images/Logo.png') }}" alt="Leoni Logo">
    </div>
    <form method="post" action="{{ path('app_reset_password_update') }}" class="log-in" autocomplete="off" id="passwordForm">
        <h4>Set New <span>Password</span></h4>
        <p>Choose a strong password to protect your account.</p>

        {% for flash_error in app.flashes('error') %}
            <div class="alert alert-danger">{{ flash_error }}</div>
        {% endfor %}

        {% for flash_success in app.flashes('success') %}
            <div class="alert alert-success">{{ flash_success }}</div>
        {% endfor %}
        
        <div class="floating-label">
            <input placeholder="New Password" type="password" name="password" id="password" required>
            <label for="password">New Password:</label>
            <div class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                    <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
                </svg>
            </div>
        </div>

        <div class="floating-label">
            <input placeholder="Confirm Password" type="password" name="confirm_password" id="confirm_password" required>
            <label for="confirm_password">Confirm Password:</label>
            <div class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                    <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
                </svg>
            </div>
        </div>

        <div class="password-requirements">
            <div class="requirements-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                Password Requirements
            </div>
            <div class="requirement" id="length">
                <span class="icon-check">⚪</span> At least 8 characters
            </div>
            <div class="requirement" id="uppercase">
                <span class="icon-check">⚪</span> At least one uppercase letter
            </div>
            <div class="requirement" id="lowercase">
                <span class="icon-check">⚪</span> At least one lowercase letter
            </div>
            <div class="requirement" id="number">
                <span class="icon-check">⚪</span> At least one number
            </div>
            <div class="requirement" id="match">
                <span class="icon-check">⚪</span> Passwords match
            </div>
        </div>

        <button type="submit" id="submitBtn" disabled>Update Password</button>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    const submitBtn = document.getElementById('submitBtn');
    const requirements = {
        length: false,
        uppercase: false,
        lowercase: false,
        number: false,
        match: false
    };

    function updateRequirement(id, valid) {
        const element = document.getElementById(id);
        const icon = element.querySelector('.icon-check');
        element.className = 'requirement ' + (valid ? 'valid' : 'invalid');
        icon.textContent = valid ? '✅' : '⚪';
        requirements[id] = valid;
        
        // Enable submit button if all requirements are met
        submitBtn.disabled = !Object.values(requirements).every(Boolean);
    }

    function checkPassword() {
        const value = password.value;
        updateRequirement('length', value.length >= 8);
        updateRequirement('uppercase', /[A-Z]/.test(value));
        updateRequirement('lowercase', /[a-z]/.test(value));
        updateRequirement('number', /[0-9]/.test(value));
        updateRequirement('match', value === confirmPassword.value && value !== '');
    }

    password.addEventListener('input', checkPassword);
    confirmPassword.addEventListener('input', checkPassword);
});
</script>
{% endblock %}
