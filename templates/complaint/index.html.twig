{% extends 'base.html.twig' %}

{% block title %}My Complaints{% endblock %}

{% block body %}
    {% include 'navbar.html.twig' %}
    
    <div class="container mt-5 pt-5">
        <div class="row mb-4">
            <div class="col-md-8">
                <h1 class="page-title">My Complaints</h1>
                <p class="text-muted">View and manage your submitted complaints</p>
            </div>
            <div class="col-md-4 text-end">
                <div class="search-container">
                    <input type="text" id="searchInput" class="search-input" placeholder="Search by subject...">
                    <div class="search-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="search-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </div>
            </div>
        </div>

        {% for message in app.flashes('success') %}
            <div class="alert alert-success alert-dismissible fade show shadow-sm" role="alert">
                <i class="fas fa-check-circle me-2"></i> {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}

        <div class="card shadow mb-4">
            <div class="card-header bg-white py-3">
                <div class="row align-items-center">
                    <div class="col">
                        <h5 class="mb-0 fw-bold text-primary">
                            <i class="fas fa-clipboard-list me-2"></i> Your Complaints
                        </h5>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                {% if complaints|length > 0 %}
                    <div class="table-responsive">
                        <table class="table table-hover complaint-table mb-0" id="complaintsTable">
                            <thead class="table-light">
                                <tr>
                                    <th>Subject</th>
                                    <th>Date Submitted</th>
                                    <th>Status</th>
                                    <th>Last Update</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for complaint in complaints %}
                                    <tr class="complaint-row" data-status="{{ complaint.status.value|lower }}">
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="complaint-icon me-3">
                                                    <i class="fas fa-comment-alt text-primary"></i>
                                                </div>
                                                <div>
                                                    <span class="fw-bold text-dark">{{ complaint.subject }}</span>
                                                    <span class="d-block text-truncate complaint-excerpt" style="max-width: 250px;">
                                                        {{ complaint.description|striptags|slice(0, 60) }}{% if complaint.description|length > 60 %}...{% endif %}
                                                    </span>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="date-info">
                                                <span class="fw-bold">{{ complaint.createdAt|date('d/m/Y') }}</span>
                                                <span class="d-block text-muted small">{{ complaint.createdAt|date('H:i') }}</span>
                                            </div>
                                        </td>
                                        <td>
                                            {% if complaint.status.value == 'PENDING' %}
                                                <span class="badge bg-warning text-dark status-badge">
                                                    <i class="fas fa-clock me-1"></i> Pending
                                                </span>
                                            {% elseif complaint.status.value == 'PROCESSING' %}
                                                <span class="badge bg-info status-badge">
                                                    <i class="fas fa-spinner fa-spin me-1"></i> Processing
                                                </span>
                                            {% elseif complaint.status.value == 'RESOLVED' %}
                                                <span class="badge bg-success status-badge">
                                                    <i class="fas fa-check-circle me-1"></i> Resolved
                                                </span>
                                            {% elseif complaint.status.value == 'REJECTED' %}
                                                <span class="badge bg-danger status-badge">
                                                    <i class="fas fa-times-circle me-1"></i> Rejected
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if complaint.updatedAt %}
                                                <div class="date-info">
                                                    <span class="fw-bold">{{ complaint.updatedAt|date('d/m/Y') }}</span>
                                                    <span class="d-block text-muted small">{{ complaint.updatedAt|date('H:i') }}</span>
                                                </div>
                                            {% else %}
                                                <span class="text-muted">N/A</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <a href="{{ path('app_complaint_show', {'id': complaint.id}) }}" class="btn btn-sm btn-primary view-btn">
                                                <i class="fas fa-eye me-1"></i> View
                                            </a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="empty-state p-5 text-center">
                        <div class="empty-state-icon mb-4">
                            <i class="fas fa-comment-slash fa-4x text-muted opacity-50"></i>
                        </div>
                        <h3 class="mb-3">No complaints yet</h3>
                        <p class="text-muted mb-4">You haven't submitted any complaints yet.</p>
                        <a href="{{ path('app_complaint_new') }}" class="btn btn-primary btn-lg">
                            <i class="fas fa-plus me-2"></i> Submit New Complaint
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <style>
        .page-title {
            font-weight: 800;
            color: #333;
            margin-bottom: 0.5rem;
            font-size: 2.2rem;
        }
        
        /* Empty State */
        .empty-state {
            padding: 4rem 2rem;
        }
        
        .empty-state-icon {
            color: #dee2e6;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                opacity: 0.7;
            }
            50% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(0.95);
                opacity: 0.7;
            }
        }
        
        .complaint-table th {
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .complaint-table td {
            vertical-align: middle;
            padding: 1rem 0.75rem;
        }
        
        .complaint-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(13, 110, 253, 0.1), rgba(13, 110, 253, 0.2));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .complaint-excerpt {
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .status-badge {
            font-weight: 500;
            padding: 0.5rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .status-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0));
            z-index: 1;
        }
        
        .status-filter .btn {
            border-radius: 50px;
            font-weight: 500;
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .status-filter .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0));
            z-index: 1;
        }
        
        .status-filter .btn.active {
            font-weight: 600;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .complaint-row {
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .complaint-row:hover {
            background-color: rgba(13, 110, 253, 0.03);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            z-index: 10;
        }
        
        /* Search Input Styling */
        .search-container {
            position: relative;
            max-width: 300px;
            margin-left: auto;
        }
        
        .search-input {
            width: 100%;
            padding: 0.6rem 1rem 0.6rem 2.5rem;
            border-radius: 50px;
            border: 1px solid rgba(0,0,0,0.1);
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            box-shadow: 0 5px 15px rgba(13, 110, 253, 0.2);
            border-color: rgba(13, 110, 253, 0.3);
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            transition: all 0.3s ease;
        }
        
        .search-spinner {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #0d6efd;
            opacity: 0;
            transition: opacity 0.3s ease;
            font-size: 0.9rem;
        }
        
        .search-active .search-icon {
            color: #0d6efd;
        }
        
        .search-active .search-spinner {
            opacity: 1;
        }
        
        .search-container.has-results .search-spinner {
            opacity: 0;
        }
        
        .search-highlight {
            background-color: rgba(255, 243, 205, 0.7);
            padding: 0.1rem 0.2rem;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .view-btn {
            border-radius: 50px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .view-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0));
            z-index: 1;
        }
        
        .view-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(13, 110, 253, 0.2);
        }
        
        /* Futuristic glowing effect for active elements */
        .btn-primary, .badge {
            position: relative;
        }
        
        .btn-primary::after, .badge::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: inherit;
            background: inherit;
            z-index: -1;
            opacity: 0;
            filter: blur(8px);
            transition: opacity 0.3s;
        }
        
        .btn-primary:hover::after, .badge:hover::after {
            opacity: 0.7;
        }
        
        /* Animated background for table rows */
        .complaint-row:nth-child(odd) {
            background: linear-gradient(90deg, rgba(248,249,252,0.5) 0%, rgba(255,255,255,0.5) 100%);
        }
        
        .complaint-row:nth-child(even) {
            background: linear-gradient(90deg, rgba(255,255,255,0.5) 0%, rgba(248,249,252,0.5) 100%);
        }
        
        /* Futuristic table header */
        .table thead th {
            background: linear-gradient(90deg, #f8f9fc 0%, #ffffff 100%);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            position: relative;
        }
        
        .table thead th::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(13, 110, 253, 0.3), transparent);
        }

        /* Enhanced Table Styles */
        .complaint-table {
            border-collapse: separate;
            border-spacing: 0 8px;
            margin-top: -8px;
        }
        
        /* Table Header Styling */
        .complaint-table thead th {
            border: none;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 1rem 0.75rem;
            color: #495057;
            background-color: #ffffff;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        /* Remove the gradient and colored underline */
        .table thead th::after {
            display: none;
        }
        
        .complaint-table tbody tr {
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-radius: 8px;
            transition: all 0.2s ease;
            margin-bottom: 8px;
            background-color: #fff;
        }
        
        .complaint-table tbody td {
            border: none;
            border-top: 1px solid rgba(0,0,0,0.03);
            border-bottom: 1px solid rgba(0,0,0,0.03);
            padding: 1rem 0.75rem;
            vertical-align: middle;
        }
        
        .complaint-table tbody td:first-child {
            border-left: 1px solid rgba(0,0,0,0.03);
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
        }
        
        .complaint-table tbody td:last-child {
            border-right: 1px solid rgba(0,0,0,0.03);
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
        }
        
        .complaint-table tbody tr:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        
        /* DataTables Custom Styling */
        .dataTables_wrapper .dataTables_length, 
        .dataTables_wrapper .dataTables_filter {
            margin-bottom: 1rem;
        }
        
        .dataTables_wrapper .dataTables_length select {
            border-radius: 50px;
            padding: 0.375rem 2rem 0.375rem 1rem;
            border: 1px solid rgba(0,0,0,0.1);
            background-position: right 0.75rem center;
        }
        
        .dataTables_wrapper .dataTables_filter input {
            border-radius: 50px;
            padding: 0.375rem 1rem;
            border: 1px solid rgba(0,0,0,0.1);
            margin-left: 0.5rem;
        }
        
        .dataTables_wrapper .dataTables_paginate .paginate_button {
            border-radius: 50px;
            padding: 0.375rem 0.75rem;
            border: none;
            margin: 0 2px;
        }
        
        .dataTables_wrapper .dataTables_paginate .paginate_button.current, 
        .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
            background: linear-gradient(to right, #2b5876, #4e4376);
            color: white !important;
            border: none;
        }
        
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background: rgba(0,0,0,0.05);
            border: none;
            color: #333 !important;
        }
        
        .dataTables_wrapper .dataTables_info {
            padding-top: 1rem;
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        /* Improved Status Badges */
        .status-badge {
            font-weight: 500;
            padding: 0.5rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 100px;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize DataTables if there are complaints
            if (document.getElementById('complaintsTable')) {
                // Initialize DataTables
                let table = $('#complaintsTable').DataTable({
                    order: [[1, 'desc']], // Sort by date submitted column descending
                    language: {
                        search: "_INPUT_",
                        searchPlaceholder: "Search complaints...",
                        lengthMenu: "Show _MENU_ complaints",
                        info: "Showing _START_ to _END_ of _TOTAL_ complaints",
                        infoEmpty: "No complaints to show",
                        infoFiltered: "(filtered from _MAX_ total complaints)"
                    },
                    pageLength: 10,
                    dom: '<"top"lf>rt<"bottom"ip>',
                    columnDefs: [
                        { orderable: false, targets: [0, 4] } // Disable sorting for subject and actions columns
                    ]
                });
                
                // Hide the default DataTables search box
                $('.dataTables_filter').hide();
                
                // Simple direct search implementation
                $('#searchInput').on('keyup', function() {
                    const searchTerm = $(this).val().trim();
                    
                    // Show spinner when typing
                    if (searchTerm.length > 0) {
                        $('.search-spinner').css('opacity', '1');
                        $('.search-icon').css('color', '#0d6efd');
                    } else {
                        $('.search-spinner').css('opacity', '0');
                        $('.search-icon').css('color', '#6c757d');
                    }
                    
                    // Apply search directly to first column (subject)
                    table.column(0).search(searchTerm, true, false).draw();
                    
                    // Hide spinner after search completes
                    setTimeout(function() {
                        $('.search-spinner').css('opacity', '0');
                    }, 300);
                });
                
                // Add animation when table loads
                setTimeout(function() {
                    $('.complaint-row').each(function(index) {
                        $(this).css({
                            'opacity': 0,
                            'transform': 'translateY(20px)'
                        });
                        
                        setTimeout(function(row) {
                            $(row).css({
                                'opacity': 1,
                                'transform': 'translateY(0)'
                            });
                        }, 100 * index, this);
                    });
                }, 300);
            }
        });
    </script>
{% endblock %} 